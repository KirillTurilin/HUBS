{% extends "base.html" %}

{% block title %}Chats - HUBs Messenger{% endblock %}

{% block header %}Chats{% endblock %}

{% block content %}
<div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
    <a href="{{ url_for('create_chat') }}" class="btn">
        <i class="fas fa-plus"></i> New Chat
    </a>
</div>

{% if chat_users %}
    <ul class="chat-list">
        {% for item in chat_users %}
            <li class="chat-item">
                <a href="{{ url_for('chat', chat_id=item.chat.id) }}" class="chat-link">
                    <div class="chat-avatar">
                        {{ item.user.username[0].upper() }}
                    </div>
                    <div class="chat-info">
                        <div class="chat-username">{{ item.user.username }}</div>
                        <div class="chat-preview">
                            {% set last_message = item.chat.messages.order_by(Message.timestamp.desc()).first() %}
                            {% if last_message %}
                                {% if last_message.sender_id == current_user.id %}
                                    You: {{ last_message.content|truncate(30) }}
                                {% else %}
                                    {{ last_message.content|truncate(30) }}
                                {% endif %}
                            {% else %}
                                No messages yet
                            {% endif %}
                        </div>
                    </div>
                </a>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <div class="empty-state">
        <i class="fas fa-comments"></i>
        <p>No chats yet. Start a new conversation!</p>
        <a href="{{ url_for('create_chat') }}" class="btn">Create New Chat</a>
    </div>
{% endif %}
{% endblock %} 